
#INCLUDE "<inc>/Util.hjk"

#MACRO INDEX2 ( M, i, j ) [ M[(i << 1) + j] ]

FN ArrEquals(
    IN a : ^UWORD,
    IN b : ^UWORD,
) : UWORD
    i := 0
    j := 0
    WHILE i < 2 DO
        WHILE j < 2 DO
            IF INDEX2(a,i,j) != INDEX2(b,i,j) THEN 
                RETURN 0
            END
            j += 1
        END
        i += 1
    END
    RETURN 1
END

A : UWORD[4]
B : UWORD[4]
C : UWORD[4]
Expected : UWORD[4] = {
    [0] = 0,
    [1] = 1,
    [2] = 1,
    [3] = 2
}

FN TestMain () : UWORD    
    i := 0
    j := 0
    
    WHILE i < 2 DO
        WHILE j < 2 DO
            INDEX2(A,i,j) = i
            INDEX2(B,i,j) = i
            j += 1
        END
        i += 1
    END

    sum : UWORD
    i = 0
    k := 0
    WHILE i < 2 DO
        j = 0
        WHILE j < 2 DO
            sum = 0
            k = 0
            WHILE k < 2 DO
                ax := INDEX2(A,i,k)
                bx := INDEX2(B,k,j)
                mul := SoftMul(ax, bx)
                PrintNum(ax)
                PrintNum(bx)
                PrintNum(mul)
                sum += mul
                k += 1
            END
            INDEX2(C,i,j) = sum
            j += 1
        END
        i += 1
    END

    RETURN NOT ArrEquals(&C[0], &Expected[0])
END

